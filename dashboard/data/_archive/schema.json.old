{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CPF Organizations Data Schema",
  "description": "Schema for storing SOC machine data, Field Kit human assessments, and Bayesian aggregations",
  "type": "object",
  "properties": {
    "metadata": {
      "type": "object",
      "properties": {
        "version": {
          "type": "string",
          "description": "Schema version"
        },
        "generated": {
          "type": "string",
          "format": "date-time",
          "description": "When this data was last generated/updated"
        },
        "total_organizations": {
          "type": "integer",
          "description": "Number of organizations in dataset"
        }
      },
      "required": ["version", "generated", "total_organizations"]
    },
    "organizations": {
      "type": "object",
      "description": "Map of organization ID to organization data",
      "patternProperties": {
        "^org-[0-9]+$": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string",
              "description": "Organization name"
            },
            "industry": {
              "type": "string",
              "enum": ["Technology", "Finance", "Healthcare", "Manufacturing", "Retail", "Government", "Education", "Other"]
            },
            "size": {
              "type": "string",
              "enum": ["small", "medium", "enterprise"],
              "description": "Organization size (employees: small <100, medium 100-1000, enterprise >1000)"
            },
            "country": {
              "type": "string",
              "description": "ISO country code"
            },
            "indicators": {
              "type": "object",
              "description": "All 100 CPF indicators (1.1 to 10.10)",
              "patternProperties": {
                "^([1-9]|10)\\.(1[0]|[1-9])$": {
                  "type": "object",
                  "properties": {
                    "soc_values": {
                      "type": "array",
                      "description": "Machine-generated assessments from SOC",
                      "items": {
                        "type": "object",
                        "properties": {
                          "timestamp": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "value": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Normalized vulnerability score (0=low, 1=high)"
                          },
                          "confidence": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Confidence in this assessment"
                          },
                          "source": {
                            "type": "string",
                            "description": "SOC system that generated this (e.g., 'siem-analyzer', 'ids-correlator')"
                          }
                        },
                        "required": ["timestamp", "value", "confidence", "source"]
                      }
                    },
                    "human_values": {
                      "type": "array",
                      "description": "Human auditor assessments from Field Kit",
                      "items": {
                        "type": "object",
                        "properties": {
                          "timestamp": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "value": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1,
                            "description": "Normalized vulnerability score from Field Kit"
                          },
                          "assessor": {
                            "type": "string",
                            "description": "Name of human auditor"
                          },
                          "assessment_id": {
                            "type": "string",
                            "description": "Unique ID linking to full Field Kit assessment"
                          }
                        },
                        "required": ["timestamp", "value", "assessor"]
                      }
                    },
                    "current_bayesian": {
                      "type": "number",
                      "minimum": 0,
                      "maximum": 1,
                      "description": "Current Bayesian-inferred value (merging SOC + human)"
                    },
                    "last_updated": {
                      "type": "string",
                      "format": "date-time"
                    }
                  },
                  "required": ["soc_values", "human_values", "current_bayesian", "last_updated"]
                }
              }
            },
            "aggregates": {
              "type": "object",
              "description": "Aggregated risk scores across all indicators",
              "properties": {
                "overall_risk": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "description": "Organization-wide Bayesian aggregate risk"
                },
                "by_category": {
                  "type": "object",
                  "description": "Risk scores by CPF category",
                  "properties": {
                    "authority": {"type": "number", "minimum": 0, "maximum": 1},
                    "temporal": {"type": "number", "minimum": 0, "maximum": 1},
                    "social": {"type": "number", "minimum": 0, "maximum": 1},
                    "affective": {"type": "number", "minimum": 0, "maximum": 1},
                    "cognitive": {"type": "number", "minimum": 0, "maximum": 1},
                    "group": {"type": "number", "minimum": 0, "maximum": 1},
                    "stress": {"type": "number", "minimum": 0, "maximum": 1},
                    "unconscious": {"type": "number", "minimum": 0, "maximum": 1},
                    "ai": {"type": "number", "minimum": 0, "maximum": 1},
                    "convergent": {"type": "number", "minimum": 0, "maximum": 1}
                  },
                  "required": ["authority", "temporal", "social", "affective", "cognitive", "group", "stress", "unconscious", "ai", "convergent"]
                },
                "confidence": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1,
                  "description": "Overall confidence in aggregate calculation"
                },
                "trend": {
                  "type": "string",
                  "enum": ["improving", "stable", "deteriorating"],
                  "description": "30-day trend direction"
                },
                "last_calculated": {
                  "type": "string",
                  "format": "date-time"
                }
              },
              "required": ["overall_risk", "by_category", "confidence", "last_calculated"]
            }
          },
          "required": ["name", "industry", "size", "indicators", "aggregates"]
        }
      }
    }
  },
  "required": ["metadata", "organizations"]
}
