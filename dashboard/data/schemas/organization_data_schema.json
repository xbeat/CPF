{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "CPF Organization Data",
  "description": "Complete data for a single organization (metadata + assessments + aggregates)",
  "type": "object",
  "required": ["id", "name", "metadata", "assessments", "aggregates"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9-]+$",
      "description": "Unique organization ID (kebab-case)"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 255,
      "description": "Organization name"
    },
    "metadata": {
      "type": "object",
      "required": ["industry", "size", "country", "language", "created_at", "updated_at"],
      "properties": {
        "industry": {
          "type": "string",
          "description": "Industry sector"
        },
        "size": {
          "type": "string",
          "enum": ["small", "medium", "enterprise"]
        },
        "country": {
          "type": "string",
          "pattern": "^[A-Z]{2}$"
        },
        "language": {
          "type": "string",
          "enum": ["en-US", "it-IT", "es-ES", "fr-FR", "de-DE"]
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "created_by": {
          "type": "string",
          "description": "Name of creator"
        },
        "notes": {
          "type": "string",
          "description": "Optional notes about organization"
        },
        "sede_sociale": {
          "type": "string",
          "description": "Registered office address / Sede legale"
        },
        "partita_iva": {
          "type": "string",
          "description": "VAT number / Partita IVA"
        }
      }
    },
    "assessments": {
      "type": "object",
      "description": "Dictionary of assessments (key = indicator_id)",
      "patternProperties": {
        "^(10|[1-9])\\.(10|[1-9])$": {
          "type": "object",
          "required": ["indicator_id", "bayesian_score", "confidence", "assessment_date"],
          "properties": {
            "indicator_id": {
              "type": "string",
              "pattern": "^(10|[1-9])\\.(10|[1-9])$",
              "description": "Indicator ID (1.1 to 10.10)"
            },
            "title": {
              "type": "string",
              "description": "Indicator title"
            },
            "category": {
              "type": "string",
              "description": "Indicator category"
            },
            "bayesian_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Bayesian risk score (0.0 = low risk, 1.0 = high risk)"
            },
            "confidence": {
              "type": "number",
              "minimum": 0,
              "maximum": 1,
              "description": "Confidence level (0.0 = low, 1.0 = high)"
            },
            "maturity_level": {
              "type": "string",
              "enum": ["green", "yellow", "red"],
              "description": "Maturity level"
            },
            "assessor": {
              "type": "string",
              "description": "Name of assessor"
            },
            "assessment_date": {
              "type": "string",
              "format": "date-time",
              "description": "Date of assessment"
            },
            "raw_data": {
              "type": "object",
              "description": "Complete assessment form data",
              "properties": {
                "quick_assessment": {
                  "type": "array",
                  "description": "Quick assessment questions and answers"
                },
                "client_conversation": {
                  "type": "object",
                  "description": "Client conversation notes and red flags"
                },
                "timestamp": {
                  "type": "string",
                  "format": "date-time"
                }
              }
            }
          }
        }
      },
      "additionalProperties": false
    },
    "aggregates": {
      "type": "object",
      "required": ["overall_risk", "overall_confidence", "by_category", "completion", "last_calculated"],
      "properties": {
        "overall_risk": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Overall risk score (average of all assessments)"
        },
        "overall_confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1,
          "description": "Overall confidence (average of all assessments)"
        },
        "trend": {
          "type": "string",
          "enum": ["improving", "stable", "deteriorating"],
          "description": "Risk trend"
        },
        "by_category": {
          "type": "object",
          "description": "Aggregates per category (1-10)",
          "patternProperties": {
            "^(10|[1-9])$": {
              "type": "object",
              "properties": {
                "category_name": {
                  "type": "string"
                },
                "avg_score": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "avg_confidence": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "total_assessments": {
                  "type": "integer",
                  "minimum": 0,
                  "maximum": 10
                },
                "completion_percentage": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100
                }
              }
            }
          }
        },
        "completion": {
          "type": "object",
          "required": ["total_indicators", "assessed_indicators", "percentage"],
          "properties": {
            "total_indicators": {
              "type": "integer",
              "const": 100,
              "description": "Total number of indicators (always 100)"
            },
            "assessed_indicators": {
              "type": "integer",
              "minimum": 0,
              "maximum": 100,
              "description": "Number of completed assessments"
            },
            "percentage": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Completion percentage"
            },
            "missing_indicators": {
              "type": "array",
              "items": {
                "type": "string",
                "pattern": "^(10|[1-9])\\.(10|[1-9])$"
              },
              "description": "Array of missing indicator IDs"
            }
          }
        },
        "last_calculated": {
          "type": "string",
          "format": "date-time",
          "description": "When aggregates were last calculated"
        },
        "maturity_model": {
          "type": "object",
          "description": "CPF Maturity Model assessment (Levels 0-5)",
          "properties": {
            "cpf_score": {
              "type": "number",
              "minimum": 0,
              "maximum": 100,
              "description": "Overall CPF Score (0-100, where 100 = optimal security posture)"
            },
            "maturity_level": {
              "type": "integer",
              "minimum": 0,
              "maximum": 5,
              "description": "Maturity level (0=Unaware, 1=Initial, 2=Developing, 3=Defined, 4=Managed, 5=Optimizing)"
            },
            "level_name": {
              "type": "string",
              "enum": ["Unaware", "Initial", "Developing", "Defined", "Managed", "Optimizing"],
              "description": "Human-readable maturity level name"
            },
            "convergence_index": {
              "type": "number",
              "minimum": 0,
              "description": "Convergence Index - measures compound risk across domains (0 = low convergence, 10+ = high convergence)"
            },
            "red_domains_count": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10,
              "description": "Number of domains (categories) with RED maturity level"
            },
            "yellow_domains_count": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10,
              "description": "Number of domains (categories) with YELLOW maturity level"
            },
            "green_domains_count": {
              "type": "integer",
              "minimum": 0,
              "maximum": 10,
              "description": "Number of domains (categories) with GREEN maturity level"
            },
            "compliance": {
              "type": "object",
              "description": "Regulatory compliance status",
              "properties": {
                "gdpr": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["compliant", "at_risk", "non_compliant"],
                      "description": "GDPR Article 32 compliance status"
                    },
                    "min_level_required": {
                      "type": "integer",
                      "const": 1,
                      "description": "Minimum maturity level for GDPR compliance"
                    },
                    "recommended_level": {
                      "type": "integer",
                      "const": 2
                    }
                  }
                },
                "nis2": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["compliant", "at_risk", "non_compliant"],
                      "description": "NIS2 Directive compliance status"
                    },
                    "min_level_required": {
                      "type": "integer",
                      "const": 2,
                      "description": "Minimum maturity level for NIS2 compliance"
                    },
                    "recommended_level": {
                      "type": "integer",
                      "const": 3
                    }
                  }
                },
                "dora": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["compliant", "at_risk", "non_compliant"],
                      "description": "DORA (Financial) compliance status"
                    },
                    "min_level_required": {
                      "type": "integer",
                      "const": 2,
                      "description": "Minimum maturity level for DORA compliance"
                    },
                    "recommended_level": {
                      "type": "integer",
                      "const": 3
                    }
                  }
                },
                "iso27001": {
                  "type": "object",
                  "properties": {
                    "status": {
                      "type": "string",
                      "enum": ["compliant", "at_risk", "non_compliant"],
                      "description": "ISO 27001:2022 compliance status"
                    },
                    "min_level_required": {
                      "type": "integer",
                      "const": 1,
                      "description": "Minimum maturity level for ISO 27001 compliance"
                    },
                    "recommended_level": {
                      "type": "integer",
                      "const": 2
                    }
                  }
                }
              }
            },
            "sector_benchmark": {
              "type": "object",
              "description": "Comparison with sector benchmarks",
              "properties": {
                "sector_mean": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Mean CPF Score for the organization's sector"
                },
                "sector_std_dev": {
                  "type": "number",
                  "minimum": 0,
                  "description": "Standard deviation for the sector"
                },
                "percentile": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 100,
                  "description": "Organization's percentile rank within their sector (0-100)"
                },
                "gap": {
                  "type": "number",
                  "description": "Gap from sector mean (positive = above average, negative = below average)"
                }
              }
            },
            "certification_path": {
              "type": "object",
              "description": "CPF Certification pathway status",
              "properties": {
                "current_certification": {
                  "type": "string",
                  "enum": ["none", "CPF-F", "CPF-P", "CPF-E", "CPF-M"],
                  "description": "Current certification level"
                },
                "eligible_for": {
                  "type": "array",
                  "items": {
                    "type": "string",
                    "enum": ["CPF-F", "CPF-P", "CPF-E", "CPF-M"]
                  },
                  "description": "Certifications the organization is eligible for based on maturity level"
                }
              }
            },
            "roi_analysis": {
              "type": "object",
              "description": "ROI analysis for moving to next maturity level",
              "properties": {
                "next_level": {
                  "type": "integer",
                  "minimum": 1,
                  "maximum": 5,
                  "description": "Next maturity level target"
                },
                "estimated_investment": {
                  "type": "number",
                  "description": "Estimated investment required (EUR)"
                },
                "annual_benefit": {
                  "type": "number",
                  "description": "Estimated annual benefit (EUR)"
                },
                "payback_months": {
                  "type": "number",
                  "description": "Estimated payback period in months"
                },
                "npv_5yr": {
                  "type": "number",
                  "description": "Net Present Value over 5 years (EUR)"
                }
              }
            }
          }
        }
      }
    }
  }
}
