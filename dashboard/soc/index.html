<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPF Dashboard - SOC + Bayesian Analysis</title>
    <link rel="stylesheet" href="../shared/styles.css">
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <header class="dashboard-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <a href="../index.html" style="display: inline-block; color: white; text-decoration: none; opacity: 0.9; margin-bottom: 10px; font-size: 14px; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.9'">
                        ‚Üê Back to Dashboard
                    </a>
                    <h1>üõ°Ô∏è CPF Dashboard</h1>
                    <p class="subtitle">SOC Integration + Bayesian Cross-Indicator Analysis</p>
                </div>
                <!-- Open Button (shown when sidebar is hidden) -->
                <button class="sidebar-open-btn" id="sidebarOpenBtn" onclick="openSidebar()" title="Show organizations">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="7" height="18"></rect>
                        <rect x="14" y="3" width="7" height="18"></rect>
                    </svg>
                    Organizations
                </button>
            </div>
        </header>

        <!-- Main Layout -->
        <div class="dashboard-main" id="dashboardMain">
            <!-- Sidebar: Organizations List -->
            <aside class="sidebar" id="sidebar">
                <div class="sidebar-header">
                    <div style="display: flex; align-items: center; gap: 10px; flex: 1; min-width: 0;">
                        <h2 style="margin: 0;">Organizations</h2>
                        <span id="org-count" class="badge">0</span>
                    </div>
                    <!-- Close Button (in sidebar) -->
                    <button class="sidebar-close-btn" id="sidebarCloseBtn" onclick="closeSidebar()" title="Hide sidebar">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                </div>
                <div id="org-list" class="org-list">
                    <!-- Populated by JS -->
                </div>
            </aside>

            <!-- Content Area -->
            <main class="content">
                <!-- Loading State -->
                <div id="loading" class="loading">
                    <div class="spinner"></div>
                    <p>Loading organizations data...</p>
                </div>

                <!-- Empty State -->
                <div id="empty-state" class="empty-state" style="display: none;">
                    <h2>üëã Welcome to CPF Dashboard</h2>
                    <p>Select an organization from the sidebar to view analysis</p>
                </div>

                <!-- Organization Detail View -->
                <div id="org-detail" class="org-detail" style="display: none;">
                    <!-- Bayesian Explanation -->
                    <div class="section" style="background: #eff6ff; border-left: 4px solid var(--primary); padding: 20px; margin-bottom: 20px; border-radius: 8px;">
                        <h3 style="margin: 0 0 12px 0; color: var(--primary); font-size: 18px;">üß† About Bayesian Cross-Indicator Analysis</h3>
                        <p style="margin: 0 0 10px 0; line-height: 1.6; color: var(--text);">
                            This dashboard uses <strong>Bayesian inference</strong> to intelligently merge data from two sources:
                            machine-generated SOC (Security Operations Center) data and human auditor assessments. The Bayesian approach
                            provides a probabilistic framework that weighs evidence from both sources, considering their confidence levels
                            and interdependencies.
                        </p>
                        <p style="margin: 0; line-height: 1.6; color: var(--text);">
                            <strong>Key features:</strong> Cross-category dependency modeling (e.g., high Authority risk influences Social risk),
                            weighted aggregation (human assessments weighted 1.5√ó for higher trust), confidence-based analysis,
                            and automated prioritization for remediation planning.
                        </p>
                    </div>

                    <!-- Overall Risk Card -->
                    <div class="risk-card">
                        <div class="risk-score-section">
                            <div class="risk-label">Overall Organizational Risk</div>
                            <div class="risk-value" id="overall-risk-value">0%</div>
                            <div class="risk-bar-container">
                                <div class="risk-bar-fill" id="overall-risk-bar"></div>
                            </div>
                        </div>
                        <div class="risk-metadata">
                            <div class="meta-item">
                                <span class="meta-label">Confidence</span>
                                <span class="meta-value" id="confidence-value">0%</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Trend</span>
                                <span class="meta-value trend" id="trend-value">-</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Last Updated</span>
                                <span class="meta-value" id="last-updated">-</span>
                            </div>
                        </div>
                    </div>

                    <!-- Category Heatmap -->
                    <section class="section">
                        <h3 class="section-title">üìä Risk by Category</h3>
                        <div id="category-heatmap" class="category-heatmap">
                            <!-- Populated by JS -->
                        </div>
                    </section>

                    <!-- Prioritization Table -->
                    <section class="section">
                        <h3 class="section-title">üéØ Prioritization Matrix</h3>
                        <p class="section-desc">Categories ordered by priority for remediation (risk √ó weight + downstream impact)</p>
                        <div class="table-container">
                            <table id="prioritization-table" class="prioritization-table">
                                <thead>
                                    <tr>
                                        <th>#</th>
                                        <th>Category</th>
                                        <th>Risk</th>
                                        <th>Confidence</th>
                                        <th>Priority Score</th>
                                        <th>Downstream Impact</th>
                                        <th>Recommendation</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- SOC vs Human Convergence -->
                    <section class="section">
                        <h3 class="section-title">üîó SOC vs Human Convergence</h3>
                        <p class="section-desc">Comparison of machine (SOC) and human (auditor) assessments</p>
                        <div id="convergence-chart" class="convergence-chart">
                            <canvas id="convergence-canvas"></canvas>
                        </div>
                    </section>

                    <!-- Indicator Grid (100 tiles) -->
                    <section class="section">
                        <h3 class="section-title">üîç Indicator Matrix (100 Indicators)</h3>
                        <p class="section-desc">Click any indicator for detailed breakdown</p>
                        <div id="indicator-grid" class="indicator-grid">
                            <!-- Populated by JS: 10x10 grid -->
                        </div>
                    </section>
                </div>
            </main>
        </div>
    </div>

    <!-- Indicator Detail Modal -->
    <div id="indicator-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close" onclick="closeIndicatorModal()">&times;</span>
            <h2 id="modal-indicator-title">Indicator X.Y</h2>
            <div id="modal-indicator-body">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="bayesian.js"></script>
    <script src="visualizations.js"></script>
    <script src="dashboard.js"></script>
</body>
</html>
