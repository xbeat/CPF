<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Edit and manage CPF indicator cards for the Auditor Field Kit">
    <title>CPF Card Editor - Interactive Indicator Cards</title>
    <link rel="stylesheet" href="../shared/styles.css">
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Language Switcher for Card Editor */
        .lang-switcher-editor {
            display: flex;
            gap: 5px;
            margin-left: 10px;
        }
        .lang-switcher-editor button {
            padding: 6px 12px;
            border: 1px solid rgba(255,255,255,0.3);
            background: rgba(255,255,255,0.1);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 12px;
            transition: all 0.2s;
        }
        .lang-switcher-editor button:hover {
            background: rgba(255,255,255,0.2);
            border-color: rgba(255,255,255,0.5);
        }
        .lang-switcher-editor button.active {
            background: white;
            color: var(--primary);
            border-color: white;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="dashboard-header" style="background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 50%, var(--accent) 100%);">
        <div style="display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 0 30px;">
            <div>
                <a href="../index.html" style="display: inline-block; color: white; text-decoration: none; opacity: 0.9; margin-bottom: 10px; font-size: 14px;" data-i18n="header.back">
                    ‚Üê Back to Dashboard
                </a>
                <h1 style="font-size: 32px; font-weight: 300; color: white; margin-bottom: 5px;">
                    <span data-i18n="header.title">üìù CPF Card Editor</span>
                </h1>
                <p class="subtitle" data-i18n="header.subtitle">Edit Interactive Indicator Cards (Auditor Field Kit)</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
                <!-- Language Switcher -->
                <div class="lang-switcher-editor">
                    <button data-lang="en">EN</button>
                    <button data-lang="it">IT</button>
                </div>
                <div id="github-status" style="padding: 8px 16px; background: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px; color: white;">
                    <span id="status-icon">üíæ</span> <span id="status-text" data-i18n="status.local">Local Mode</span>
                </div>
                <input type="file" id="load-json-input" accept=".json" style="display: none;">
                <button id="load-json-btn" class="sidebar-open-btn" title="Load JSON file from computer" data-i18n="button.load-json">
                    üìÇ Load JSON
                </button>
                <button id="save-local-btn" class="sidebar-open-btn" title="Save to local file" data-i18n="button.save-local">
                    üíæ Save Local
                </button>
                <button id="save-github-btn" class="sidebar-open-btn" style="display: none;" title="Commit to GitHub" data-i18n="button.save-github">
                    üì§ Commit to GitHub
                </button>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="editor-container">
        <!-- Sidebar: Card Navigation -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h2 style="margin: 0;" data-i18n="sidebar.title">Cards</h2>
                <span id="card-count" class="badge">0</span>
            </div>
            <div class="sidebar-controls">
                <input type="text" id="card-search" class="search-input" data-i18n-placeholder="sidebar.search" placeholder="üîç Search cards...">
                <select id="category-filter" class="sort-select">
                    <option value="" data-i18n="sidebar.filter.all">All Categories</option>
                    <option value="1" data-i18n="category.1">1.x Authority</option>
                    <option value="2" data-i18n="category.2">2.x Temporal</option>
                    <option value="3" data-i18n="category.3">3.x Social</option>
                    <option value="4" data-i18n="category.4">4.x Affective</option>
                    <option value="5" data-i18n="category.5">5.x Cognitive</option>
                    <option value="6" data-i18n="category.6">6.x Group</option>
                    <option value="7" data-i18n="category.7">7.x Stress</option>
                    <option value="8" data-i18n="category.8">8.x Unconscious</option>
                    <option value="9" data-i18n="category.9">9.x AI</option>
                    <option value="10" data-i18n="category.10">10.x Convergent</option>
                </select>
            </div>
            <div class="sidebar-content">
                <div id="card-list" class="org-list">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div data-i18n="sidebar.loading">Loading cards...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content: Editor + Preview -->
        <div class="main-content">
            <!-- Alert Container -->
            <div id="alertContainer"></div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state">
                <div class="empty-state-icon">üìù</div>
                <h2 class="empty-state-title" data-i18n="empty.title">Select a Card to Edit</h2>
                <p class="empty-state-text" data-i18n="empty.subtitle">Choose a card from the sidebar to begin editing</p>
            </div>

            <!-- Editor Section -->
            <div id="editorSection" class="hidden">
                <!-- Tabs -->
                <div class="dashboard-tabs">
                    <button class="tab active" data-tab="edit" data-i18n="tab.edit">‚úèÔ∏è Edit</button>
                    <button class="tab" data-tab="preview" data-i18n="tab.preview">üëÅÔ∏è Preview</button>
                    <button class="tab" data-tab="json" data-i18n="tab.json">{ } Raw JSON</button>
                </div>

                <!-- Edit Tab -->
                <div id="editTab" class="tab-content active">
                    <div class="card-editor-form" id="cardEditorForm">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- Preview Tab -->
                <div id="previewTab" class="tab-content">
                    <div class="card-preview" id="cardPreview">
                        <!-- Populated by JS -->
                    </div>
                </div>

                <!-- JSON Tab -->
                <div id="jsonTab" class="tab-content">
                    <div class="json-editor">
                        <!-- JSON Search Bar -->
                        <div class="json-search-bar">
                            <input type="text" id="jsonSearchInput" data-i18n-placeholder="json.search" placeholder="Search in JSON..." />
                            <button id="jsonSearchPrev" class="btn-icon" data-i18n-title="json.prev" title="Previous match">‚ñ≤</button>
                            <button id="jsonSearchNext" class="btn-icon" data-i18n-title="json.next" title="Next match">‚ñº</button>
                            <span id="jsonSearchCount"></span>
                            <button id="jsonSearchClear" class="btn-icon" data-i18n-title="json.clear" title="Clear search">‚úï</button>
                        </div>

                        <textarea id="jsonEditor" spellcheck="false"></textarea>
                        <button id="format-json-btn" class="btn btn-secondary" data-i18n="json.format">Format JSON</button>
                        <button id="apply-json-btn" class="btn btn-primary" data-i18n="json.apply">Apply Changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Shared UI utilities -->
    <script src="../shared/ui-utils.js"></script>
    <!-- i18n System -->
    <script src="../shared/i18n-utils.js"></script>
    <script src="translations.js"></script>
    <script>
        // Initialize i18n on page load
        document.addEventListener('DOMContentLoaded', () => {
            initLanguage(cardEditorTranslations);
            console.log('‚úÖ Card Editor i18n initialized');
        });
    </script>
    <script type="module" src="editor.js"></script>
</body>
</html>
